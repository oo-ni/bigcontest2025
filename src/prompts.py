"""ë§ˆì¼€íŒ… ì „ëµ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿"""

# ê¸°ë³¸ ë§ˆì¼€íŒ… ì „ëµ í”„ë¡¬í”„íŠ¸
MARKETING_STRATEGY_PROMPT = """
ë‹¹ì‹ ì€ ì†Œìƒê³µì¸ ë§ˆì¼€íŒ… ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì•„ë˜ ê°€ë§¹ì  ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ë§ˆì¼€íŒ… ì „ëµì„ ì œì‹œí•˜ì„¸ìš”:

{rag_context}

ìš”êµ¬ì‚¬í•­:
1. ë°ì´í„° ë¶„ì„ ê·¼ê±° (êµ¬ì²´ì  ìˆ˜ì¹˜ í•„ìˆ˜)
2. ì¶”ì²œ ë§ˆì¼€íŒ… ì±„ë„ (ìµœì†Œ 3ê°œ, ê°ê° ê·¼ê±° í¬í•¨)
3. ì‹¤í–‰ ë°©ì•ˆ (êµ¬ì²´ì , ë‹¨ê³„ë³„ ì„¤ëª…)
4. ì˜ˆìƒ íš¨ê³¼ (ì •ëŸ‰ì  ìˆ˜ì¹˜)
5. ë¹„ìš© ë° ì‹œê°„ ì†Œìš” ì¶”ì •

ë‹µë³€ í˜•ì‹:

## ğŸ“Š ë°ì´í„° ë¶„ì„ ê²°ê³¼
[ìˆ˜ì¹˜ë¥¼ í¬í•¨í•œ í˜„í™© ë¶„ì„]

## ğŸ¯ ì¶”ì²œ ë§ˆì¼€íŒ… ì „ëµ

### 1. [ì±„ë„ëª…] (ìš°ì„ ìˆœìœ„: ìƒ/ì¤‘/í•˜)
**ê·¼ê±°:** [ë°ì´í„° ê¸°ë°˜ ì´ìœ , ìˆ˜ì¹˜ í¬í•¨]
**ì‹¤í–‰ ë°©ì•ˆ:**
- 1ë‹¨ê³„: [êµ¬ì²´ì  ì•¡ì…˜]
- 2ë‹¨ê³„: [êµ¬ì²´ì  ì•¡ì…˜]
- 3ë‹¨ê³„: [êµ¬ì²´ì  ì•¡ì…˜]
**ì˜ˆìƒ íš¨ê³¼:** [ì •ëŸ‰ì  ìˆ˜ì¹˜]
**ì˜ˆìƒ ë¹„ìš©:** [ê¸ˆì•¡ ë²”ìœ„]
**ì†Œìš” ì‹œê°„:** [ê¸°ê°„]

### 2. [ë‹¤ìŒ ì±„ë„...]

## ğŸ’¡ ì¶”ê°€ ì œì•ˆì‚¬í•­
[ì°¸ê³ í• ë§Œí•œ ì‚¬í•­]
"""


# í‰ê°€ í•­ëª© B-1: ì¹´í˜ ì—…ì¢… ê³ ê° íŠ¹ì„± ë¶„ì„
CAFE_CUSTOMER_ANALYSIS_PROMPT = """
ë‹¹ì‹ ì€ ì¹´í˜ ì „ë¬¸ ë§ˆì¼€íŒ… ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì•„ë˜ ì¹´í˜ ê°€ë§¹ì ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì£¼ìš” ë°©ë¬¸ ê³ ê° íŠ¹ì„±ì— ë”°ë¥¸ ë§ˆì¼€íŒ… ì±„ë„ ì¶”ì²œ ë° í™ë³´ì•ˆì„ ì‘ì„±í•˜ì„¸ìš”:

{rag_context}

ë¶„ì„í•  ë‚´ìš©:
1. ì£¼ìš” ê³ ê°ì¸µ (ì—°ë ¹ëŒ€, ì„±ë³„)
2. ë°©ë¬¸ íŒ¨í„´ (ê±°ì£¼/ì§ì¥/ìœ ë™)
3. ì¬ë°©ë¬¸ìœ¨ ë° ì‹ ê·œ ê³ ê° ë¹„ìœ¨
4. ë§¤ì¶œ ì‹œê°„ëŒ€ ë¶„ì„

ìš”êµ¬ì‚¬í•­:
1. **ê³ ê° íŠ¹ì„± ë¶„ì„**: ë°ì´í„°ì— ê¸°ë°˜í•œ êµ¬ì²´ì  ìˆ˜ì¹˜
2. **ë§ˆì¼€íŒ… ì±„ë„ ì¶”ì²œ**: ê³ ê° íŠ¹ì„±ì— ë§ëŠ” ì±„ë„ 3ê°œ ì´ìƒ
3. **í™ë³´ì•ˆ**: ê° ì±„ë„ë³„ êµ¬ì²´ì  ì‹¤í–‰ ë°©ì•ˆ
4. **ì˜ˆìƒ íš¨ê³¼**: ì‹ ê·œ ê³ ê° ìœ ì…, ë§¤ì¶œ ì¦ê°€ ë“±

ë‹µë³€ í˜•ì‹:

## ğŸ“Š ê³ ê° íŠ¹ì„± ë¶„ì„
- ì£¼ìš” ê³ ê°ì¸µ: [ì—°ë ¹ëŒ€, ì„±ë³„, ë¹„ìœ¨]
- ë°©ë¬¸ íŒ¨í„´: [ê±°ì£¼/ì§ì¥/ìœ ë™ ë¹„ìœ¨]
- ì¬ë°©ë¬¸ìœ¨: [ìˆ˜ì¹˜ ë° ì—…ì¢… í‰ê·  ëŒ€ë¹„]

## ğŸ¯ ì¶”ì²œ ë§ˆì¼€íŒ… ì±„ë„

### ì±„ë„ 1: [ì±„ë„ëª…]
**ì„ ì • ê·¼ê±°:** [ê³ ê° íŠ¹ì„±ê³¼ ì—°ê²°]
**í™ë³´ì•ˆ:**
- íƒ€ê²Ÿ: [êµ¬ì²´ì  íƒ€ê²Ÿ ê³ ê°]
- ë©”ì‹œì§€: [í•µì‹¬ ë©”ì‹œì§€]
- ì‹¤í–‰ ë°©ì•ˆ: [ë‹¨ê³„ë³„ ê³„íš]
**ì˜ˆìƒ íš¨ê³¼:** [ì‹ ê·œ ê³ ê° ìœ ì… Xëª…, ë§¤ì¶œ ì¦ê°€ Y%]
**ì˜ˆì‚°:** [ê¸ˆì•¡]

### ì±„ë„ 2: [ë‹¤ìŒ ì±„ë„...]

## ğŸ’¡ ì‹¤í–‰ ìš°ì„ ìˆœìœ„
[ì‹œê¸‰ì„± ë° íš¨ê³¼ì„± ê¸°ì¤€ ìš°ì„ ìˆœìœ„]
"""


# í‰ê°€ í•­ëª© B-2: ì¬ë°©ë¬¸ìœ¨ í–¥ìƒ ì „ëµ
REVISIT_RATE_IMPROVEMENT_PROMPT = """
ë‹¹ì‹ ì€ ê³ ê° ë¦¬í…ì…˜ ì „ë¬¸ ë§ˆì¼€íŒ… ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì•„ë˜ ê°€ë§¹ì ì˜ ì¬ë°©ë¬¸ìœ¨ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì¬ë°©ë¬¸ìœ¨ì„ ë†’ì¼ ìˆ˜ ìˆëŠ” ë§ˆì¼€íŒ… ì•„ì´ë””ì–´ì™€ ê·¼ê±°ë¥¼ ì œì‹œí•˜ì„¸ìš”:

{rag_context}

ë¶„ì„í•  ë‚´ìš©:
1. í˜„ì¬ ì¬ë°©ë¬¸ìœ¨ ë° ì—…ì¢… í‰ê·  ëŒ€ë¹„
2. ì‹ ê·œ ê³ ê° ìœ ì… í˜„í™©
3. ê³ ê° ì¶©ì„±ë„ ê´€ë ¨ ì§€í‘œ

ìš”êµ¬ì‚¬í•­:
1. **ë¬¸ì œì  ì§„ë‹¨**: ì¬ë°©ë¬¸ìœ¨ì´ ë‚®ì€ ì›ì¸ ë¶„ì„
2. **ê°œì„  ì „ëµ**: êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ë°©ì•ˆ
3. **ë°ì´í„° ê·¼ê±°**: ëª¨ë“  ì œì•ˆì€ ë°ì´í„°ì— ê¸°ë°˜
4. **ì˜ˆìƒ íš¨ê³¼**: ì¬ë°©ë¬¸ìœ¨ ëª©í‘œ ìˆ˜ì¹˜ ì œì‹œ

ë‹µë³€ í˜•ì‹:

## ğŸ“Š í˜„í™© ë¶„ì„
- í˜„ì¬ ì¬ë°©ë¬¸ìœ¨: [ìˆ˜ì¹˜]
- ì—…ì¢… í‰ê· : [ìˆ˜ì¹˜]
- ì‹ ê·œ vs ì¬ë°©ë¬¸ ê³ ê° ë¹„ìœ¨: [ìˆ˜ì¹˜]

## âŒ ë¬¸ì œì  ì§„ë‹¨
[ì¬ë°©ë¬¸ìœ¨ì´ ë‚®ì€ ì´ìœ , ë°ì´í„° ê¸°ë°˜]

## ğŸ¯ ì¬ë°©ë¬¸ìœ¨ í–¥ìƒ ì „ëµ

### ì „ëµ 1: [ì „ëµëª…]
**ê·¼ê±°:** [ë°ì´í„° ë¶„ì„ ê²°ê³¼]
**ì‹¤í–‰ ë°©ì•ˆ:**
- ë‹¨ê³„ 1: [êµ¬ì²´ì  ì‹¤í–‰ ë°©ë²•]
- ë‹¨ê³„ 2: [êµ¬ì²´ì  ì‹¤í–‰ ë°©ë²•]
**íƒ€ê²Ÿ ì¬ë°©ë¬¸ìœ¨:** [ëª©í‘œ ìˆ˜ì¹˜]
**ì˜ˆìƒ ê¸°ê°„:** [ê¸°ê°„]
**ì˜ˆì‚°:** [ê¸ˆì•¡]

### ì „ëµ 2: [ë‹¤ìŒ ì „ëµ...]

## ğŸ“ˆ ì˜ˆìƒ íš¨ê³¼
- ëª©í‘œ ì¬ë°©ë¬¸ìœ¨: [ìˆ˜ì¹˜]
- ì˜ˆìƒ ë§¤ì¶œ ì¦ê°€: [ê¸ˆì•¡ ë˜ëŠ” ë¹„ìœ¨]
- ê³ ê° ìƒì•  ê°€ì¹˜ í–¥ìƒ: [ë¶„ì„]
"""


# í‰ê°€ í•­ëª© B-3: ìš”ì‹ì—… ë¬¸ì œì  ë¶„ì„
RESTAURANT_PROBLEM_ANALYSIS_PROMPT = """
ë‹¹ì‹ ì€ ìš”ì‹ì—… ì „ë¬¸ ê²½ì˜ ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì•„ë˜ ìš”ì‹ì—… ê°€ë§¹ì ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ í˜„ì¬ ê°€ì¥ í° ë¬¸ì œì ê³¼ ì´ë¥¼ ë³´ì™„í•  ë§ˆì¼€íŒ… ì•„ì´ë””ì–´ ë° ê·¼ê±°ë¥¼ ì œì‹œí•˜ì„¸ìš”:

{rag_context}

ë¶„ì„í•  ë‚´ìš©:
1. ë§¤ì¶œ ìˆœìœ„ (ë™ì¼ ìƒê¶Œ/ì—…ì¢… ë‚´)
2. í•´ì§€ ê°€ë§¹ì  ë¹„ìœ¨
3. ê³ ê° íŠ¹ì„± ë° ë°©ë¬¸ íŒ¨í„´
4. ìš´ì˜ ê¸°ê°„ ë° ë§¤ì¶œ ì¶”ì´

ìš”êµ¬ì‚¬í•­:
1. **í•µì‹¬ ë¬¸ì œì  ë„ì¶œ**: ë°ì´í„° ê¸°ë°˜ ìš°ì„ ìˆœìœ„í™”
2. **ì›ì¸ ë¶„ì„**: ì™œ ì´ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ê°€
3. **í•´ê²° ë°©ì•ˆ**: êµ¬ì²´ì ì´ê³  ì‹¤í˜„ ê°€ëŠ¥í•œ ë§ˆì¼€íŒ… ì „ëµ
4. **ì‹¤í–‰ ë¡œë“œë§µ**: ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš

ë‹µë³€ í˜•ì‹:

## ğŸ“Š ë°ì´í„° ë¶„ì„
- ë™ì¼ ìƒê¶Œ ë‚´ ë§¤ì¶œ ìˆœìœ„: [ìˆ˜ì¹˜ ë° ë°±ë¶„ìœ„]
- ë™ì¼ ì—…ì¢… ë‚´ ë§¤ì¶œ ìˆœìœ„: [ìˆ˜ì¹˜ ë° ë°±ë¶„ìœ„]
- í•´ì§€ìœ¨ ë¹„êµ: [ê°€ë§¹ì  vs ì—…ì¢… í‰ê· ]
- ì£¼ìš” ê³ ê°ì¸µ: [íŠ¹ì„±]

## âŒ í•µì‹¬ ë¬¸ì œì 
### ë¬¸ì œ 1: [ê°€ì¥ í° ë¬¸ì œ]
**ê·¼ê±°:** [ë°ì´í„° ê¸°ë°˜ ë¶„ì„]
**ì‹¬ê°ë„:** [ìƒ/ì¤‘/í•˜]

### ë¬¸ì œ 2: [ë‘ ë²ˆì§¸ ë¬¸ì œ]
**ê·¼ê±°:** [ë°ì´í„° ê¸°ë°˜ ë¶„ì„]
**ì‹¬ê°ë„:** [ìƒ/ì¤‘/í•˜]

## ğŸ¯ í•´ê²° ë°©ì•ˆ

### ë¬¸ì œ 1 í•´ê²° ì „ëµ
**ë§ˆì¼€íŒ… ì•„ì´ë””ì–´:** [êµ¬ì²´ì  ë°©ì•ˆ]
**ì‹¤í–‰ ë°©ì•ˆ:**
1. ì¦‰ì‹œ ì‹¤í–‰ (1ì£¼): [ì•¡ì…˜]
2. ë‹¨ê¸° (1ê°œì›”): [ì•¡ì…˜]
3. ì¤‘ê¸° (3ê°œì›”): [ì•¡ì…˜]
**ì˜ˆìƒ íš¨ê³¼:** [ìˆ˜ì¹˜]
**ì˜ˆì‚°:** [ê¸ˆì•¡]

### ë¬¸ì œ 2 í•´ê²° ì „ëµ
[ë™ì¼ í˜•ì‹]

## ğŸ“ˆ ì¢…í•© ë¡œë“œë§µ
[ì „ì²´ ì‹¤í–‰ ì¼ì • ë° ë§ˆì¼ìŠ¤í†¤]
"""


# í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì„ íƒ í•¨ìˆ˜
def get_prompt_template(template_name: str = "default") -> str:
    """
    í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸°

    Args:
        template_name: í…œí”Œë¦¿ ì´ë¦„
            - "default": ê¸°ë³¸ ë§ˆì¼€íŒ… ì „ëµ
            - "cafe_customer": ì¹´í˜ ê³ ê° ë¶„ì„ (B-1)
            - "revisit_rate": ì¬ë°©ë¬¸ìœ¨ í–¥ìƒ (B-2)
            - "restaurant_problem": ìš”ì‹ì—… ë¬¸ì œ ë¶„ì„ (B-3)

    Returns:
        í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë¬¸ìì—´
    """
    templates = {
        "default": MARKETING_STRATEGY_PROMPT,
        "cafe_customer": CAFE_CUSTOMER_ANALYSIS_PROMPT,
        "revisit_rate": REVISIT_RATE_IMPROVEMENT_PROMPT,
        "restaurant_problem": RESTAURANT_PROBLEM_ANALYSIS_PROMPT,
    }

    return templates.get(template_name, MARKETING_STRATEGY_PROMPT)


def format_rag_context(rag_results: list) -> str:
    """
    RAG ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬ë§·íŒ…

    Args:
        rag_results: RAG ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸

    Returns:
        í¬ë§·íŒ…ëœ ì»¨í…ìŠ¤íŠ¸ ë¬¸ìì—´
    """
    if not rag_results:
        return "ê´€ë ¨ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

    context_parts = []
    for idx, result in enumerate(rag_results, 1):
        text = result.get('text', '')
        score = result.get('score', 0)
        metadata = result.get('metadata', {})

        context_parts.append(f"""
### ê°€ë§¹ì  ë°ì´í„° {idx} (ê´€ë ¨ë„: {score:.2f})
{text}

ë©”íƒ€ë°ì´í„°: {metadata}
---
""")

    return "\n".join(context_parts)
